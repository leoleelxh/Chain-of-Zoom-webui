# 🔎 Chain-of-Zoom Gradio 界面使用指南

这是一个为 Chain-of-Zoom 项目创建的用户友好的 Web 界面，让你可以通过浏览器轻松使用极端超分辨率功能。

## 🌟 界面版本选择

### 🇺🇸 英文版界面 (English Interface)
- **文件**: `gradio_interface.py`
- **启动**: `python run_gradio.py`
- **端口**: 7860
- **特点**: 面向国际用户，界面为英文

### 🇨🇳 中文版界面 (Chinese Interface) 
- **文件**: `gradio_interface_cn.py`
- **启动**: `python run_gradio_cn.py`
- **端口**: 7861
- **特点**: 完全中文界面，显存优化提示更详细

## 🚀 快速开始

### 1. 安装依赖
```bash
# 安装所有必要的依赖包
pip install -r requirements.txt
```

### 2. 启动界面

**中文版 (推荐):**
```bash
python run_gradio_cn.py
```

**英文版:**
```bash
python run_gradio.py
```

### 3. 访问界面
- 中文版: http://localhost:7861
- 英文版: http://localhost:7860

## 🔥 24GB显存优化指南

### 🎯 预设配置 (中文版专有)

#### 🛡️ 极度保守模式 (8-12GB显存使用)
- **处理尺寸**: 256
- **VAE分块**: 128  
- **递归次数**: 2
- **适用场景**: 大图处理、显存紧张

#### ⚖️ 保守模式 (12-18GB显存使用)
- **处理尺寸**: 384
- **VAE分块**: 192
- **递归次数**: 3  
- **适用场景**: 中等图像、平衡性能

#### 🚀 平衡模式 (18-24GB显存使用)
- **处理尺寸**: 512
- **VAE分块**: 224
- **递归次数**: 4
- **适用场景**: 小图像、追求质量

### 🔧 手动优化策略

**如果遇到CUDA OOM错误:**
1. 🛡️ 立即使用"极度保守"预设
2. 📉 降低处理尺寸到256或更低
3. 🧩 减小VAE分块大小到128
4. 🔢 减少递归次数到2
5. 💾 确保开启内存优化模式
6. 🎛️ 使用fp16精度

**性能调优建议:**
- **显存不足**: 降低所有尺寸参数
- **处理太慢**: 适当增加分块大小
- **质量不佳**: 增加处理尺寸和重叠大小

## 📋 界面功能说明

### 输入配置区域
- **Input Image**: 上传你要处理的图像
- **Basic Parameters**: 基本参数设置
  - **Recursion Type**: 递归处理类型
  - **Prompt Type**: 提示生成方式
  - **Custom Prompt**: 自定义提示文本
- **Advanced Parameters**: 高级参数（点击展开）
  - **Recursion Number**: 递归次数（1-8）
  - **Upscale Factor**: 每步放大倍数（2-8）
  - **Color Alignment Method**: 颜色校正方法
  - **Process Size**: 处理分辨率
  - **Efficient Memory Mode**: 内存优化模式
  - **Mixed Precision**: 数值精度

### 结果显示区域
- **Status**: 处理状态和信息
- **Final Result**: 最终合成结果（所有尺度拼接）
- **Individual Scale Results**: 各个尺度的单独结果

### 示例图像
界面会自动加载 `samples/` 目录中的示例图像，点击即可快速测试。

## 🎯 参数详解

### 🔄 递归类型
- **最近邻插值**: 最快，质量最低
- **双三次插值**: 快速，中等质量
- **单步超分辨率**: 一次处理，较快
- **递归处理**: 逐步放大，质量好
- **多尺度递归**: 最佳质量，最慢 (推荐)

### 💬 提示类型
- **无提示**: 最快，无文本引导
- **DAPE模型**: 预训练模型提示
- **视觉语言模型**: 最佳效果，较慢 (推荐)

### 🖼️ 关键参数
- **处理尺寸**: 🔥 最关键！直接影响显存使用
- **VAE分块大小**: 🔥 第二重要！控制VAE显存
- **递归次数**: ⚡ 影响最终放大倍数
- **内存优化**: 💾 24GB显存必开！

## 🛠️ 内存优化工具

### 使用memory_optimizer.py
```bash
python memory_optimizer.py
```

**功能包括:**
- 📊 查看GPU内存状态
- 🧹 清理GPU内存
- 🚀 系统优化设置
- 🎯 获取个性化推荐
- 📈 实时内存监控
- ⚠️ 终止GPU进程

## 🚨 常见问题解决

### 问题: 界面启动失败
**解决方案:**
```bash
# 检查依赖
pip install gradio>=4.0.0 torch torchvision

# 检查端口占用
netstat -an | findstr :7860
netstat -an | findstr :7861
```

### 问题: 处理卡住不动
**解决方案:**
1. 使用极度保守预设
2. 检查GPU占用: `nvidia-smi`
3. 重启Python进程
4. 运行内存优化工具

### 问题: CUDA内存溢出
**解决方案:**
1. 降低所有尺寸参数至最小
2. 确保开启内存优化模式
3. 使用fp16精度
4. 减少递归次数到1-2

### 问题: 生成质量差
**解决方案:**
1. 增加处理尺寸
2. 使用VLM提示类型
3. 增加分块重叠大小
4. 添加自定义提示词

## 📈 性能对比

| 配置模式 | 显存使用 | 处理速度 | 图像质量 | 适用场景 |
|---------|---------|---------|---------|---------|
| 极度保守 | 8-12GB | 较慢 | 中等 | 大图/显存紧张 |
| 保守模式 | 12-18GB | 中等 | 良好 | 日常使用 |
| 平衡模式 | 18-24GB | 较快 | 优秀 | 追求质量 |

## 🎯 使用技巧

### 1. 图像预处理
- 建议输入图像分辨率不超过1024x1024
- 使用PNG或JPG格式
- 避免过度压缩的图像

### 2. 参数选择
- 小图(<512px): 平衡模式
- 中图(512-1024px): 保守模式  
- 大图(>1024px): 极度保守模式

### 3. 质量优化
- 添加描述性提示词
- 使用VLM提示类型
- 适当增加递归次数

### 4. 速度优化
- 使用null提示类型
- 降低处理尺寸
- 减少递归次数

## 🔗 相关文件

- `gradio_interface.py` - 英文版界面
- `gradio_interface_cn.py` - 中文版界面  
- `run_gradio.py` - 英文版启动脚本
- `run_gradio_cn.py` - 中文版启动脚本
- `memory_optimizer.py` - 内存优化工具
- `inference_coz.py` - 核心推理脚本

## 📞 技术支持

如果遇到问题，请按以下顺序尝试:
1. 查看本文档的故障排除部分
2. 运行内存优化工具获取建议
3. 使用极度保守预设配置
4. 检查系统环境和依赖安装

---

**💡 提示**: 中文版界面提供了更详细的显存优化指导和醒目的警告提示，特别适合需要精细调优的用户使用。

## 📁 文件结构

```
Chain-of-Zoom/
├── gradio_interface.py     # Gradio界面主文件
├── run_gradio.py          # 启动脚本
├── GRADIO_README.md       # 本说明文档
├── inference_coz.py       # 原始推理脚本
├── requirements.txt       # 依赖包列表
├── samples/              # 示例图像
└── ckpt/                # 模型检查点
```

## 🤝 技术支持

如果遇到问题：
1. 查看控制台输出的错误信息
2. 检查GPU内存使用情况
3. 尝试调整参数设置
4. 参考原项目的 README.md

## 📝 更新日志

- **v1.0**: 初始版本，支持所有核心功能
- 完整的参数配置界面
- 实时状态显示
- 结果可视化和下载
- 示例图像快速测试

---

**享受使用 Chain-of-Zoom 进行极端超分辨率处理！** 🎉 